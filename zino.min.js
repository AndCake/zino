var Zino=function(){"use strict";function e(e){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.forEach(function(n){for(var r in n)("undefined"!=typeof HTMLElement&&n instanceof HTMLElement||void 0!==t(n,r).value&&(!e[r]||t(e,r).writable))&&"attributes"!==r&&(e[r]=n[r])}),e}function t(e,t){return S(e)&&Object.getOwnPropertyDescriptor(e,t)||{}}function n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function r(e,t){t.name.indexOf("--event-")&&o("--event-"+e,t)}function o(e,t){if(R[e])for(var n in R[e]){r("trigger",{name:e,fn:R[e][n],data:t});var o=R[e][n](t);if(!1===o)break}}function a(e,t){R[e]||(R[e]=[]),R[e].push(t),r("register",{name:e,fn:t})}function i(e,t){if(!M(t))return delete R[e],r("unregister",{name:e});for(var n in R[e])if(R[e][n]===t)return delete R[e][n],r("unregister",{name:e,fn:t})}function c(e,t){a(e,function n(){t.apply(this,arguments),i(e,n)})}function s(e,t,n){if(M(e.addEventListener)){var r=function(t,r){for(var o=[].slice.call(e.querySelectorAll(t));o.length>0&&r!==n;){if(o.indexOf(r)>=0)return o[o.indexOf(r)];r=r.parentNode}return!1};t.forEach(function(t){Object.keys(t.handlers).forEach(function(o){e.addEventListener(o,function(e){var a=void 0;(":host"===t.selector||(a=r(t.selector,e.target)))&&(a&&(a.getHost=function(){return n.getHost()}),t.handlers[o].call(a||n,e))},!1)})})}}function u(e){return"[object Array]"===Object.prototype.toString.call(e)}function l(e){U=e}function f(e,t,n){e=e.toLowerCase(),t=t||{},Object.keys(t).forEach(function(e){t[e]={name:e,value:t[e]}}),n=n&&("object"!==(void 0===n?"undefined":z(n))||n.tagName)?[n]:n||[];var r={tagName:e,attributes:t,children:n,__complexity:n.reduce(function(e,t){return e+(t.__complexity||1)},0)+n.length};return q.indexOf(e)>=0&&D.push(r),r}function d(e,t){var n=[];return e=(e||"").toLowerCase(),"function"==typeof t.getElementsByTagName?[].slice.call(t.getElementsByTagName(e)):(t.children&&(n=n.concat(t.children.filter(function(t){return t.tagName&&t.tagName.toLowerCase()===e})),t.children.forEach(function(t){n=n.concat(d(e,t))})),n)}function p(e){q=e}function g(){D=[]}function h(){return D}function m(e){return e.children?(u(e.children)||(e.children=[e.children]),(u(e)&&e||e.children).map(function(e){if("object"!==(void 0===e?"undefined":z(e)))return""+e;if(u(e))return m(e);var t=[""].concat(Object.keys(e.attributes).map(function(t){return"object"===z(e.attributes[t].value)?t+'="--'+U(t,e.attributes[t].value)+'--"':t+'="'+e.attributes[t].value+'"'}));return"<"+e.tagName+t.join(" ")+">"+m(e)+"</"+e.tagName+">"}).join("")):""}function v(e,t){var n=void 0;return"object"!==(void 0===e?"undefined":z(e))?n=t.createTextNode(""+e):(n=t.createElement(e.tagName),Object.keys(e.attributes).forEach(function(t){n.setAttribute(t,e.attributes[t].value)}),e.__vdom&&o("--zino-initialize-node",{tag:n,node:e.functions}),n.innerHTML=m(e)),n}function b(e,t,n,r){if(n.match(/<[\w:_-]+[^>]*>/))if(1===t.childNodes.length)t.innerHTML=n;else{var o=r.createElement("span");o.innerHTML=n,t.replaceChild(o,e)}else t.replaceChild(v(n.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),r),e)}function y(e,t,n){u(t)||(u(t.children)||(t.children=[t.children]),t.tagName!==e.tagName.toLowerCase()?e.parentNode.replaceChild(v(t,n),e):(Object.keys(t.attributes).forEach(function(n){if("object"!==z(t.attributes[n].value))e.getAttribute(n)!=t.attributes[n].value&&e.setAttribute(n,t.attributes[n].value);else if(e.getAttribute(n)&&e.getAttribute(n).match(/^--|--$/g)){var r=U(n,t.attributes[n].value,e.getAttribute(n).replace(/^--|--$/g,""));e.setAttribute(n,"--"+r+"--")}}),e.attributes.length>Object.keys(t.attributes)&&[].forEach.call(e.attributes,function(n){void 0===t.attributes[n.name]&&e.removeAttribute(n.name)})));var r=u(t)?t:t.children;r.forEach(function(t,r){if(u(t))return y(e,t,n);var o=e.childNodes[r];void 0===o?e.appendChild(v(t,n)):3===o.nodeType?"string"==typeof t&&o.nodeValue!==t?b(o,e,t,n):"string"!=typeof t&&e.replaceChild(v(t,n),o):1===o.nodeType&&("object"===(void 0===t?"undefined":z(t))?y(o,t,n):b(o,e,t,n))}),e.childNodes.length>r.length&&[].slice.call(e.childNodes,r.length).forEach(function(t){return e.removeChild(t)})}function x(t,n,r){var o=t(f,r),a=o.tagName;P[a]||(H(o),o.functions=e({},J,o.functions),P[a]=o,n&&[].slice.call(d(a,n)).forEach(function(e){return w(e,P[a])}))}function _(e,t){if(e.tagName){var n=P[e.tagName.toLowerCase()];if(n&&!e.getAttribute("__ready"))return t&&(n.functions.render=F),w.call(t?{noEvents:!0}:this,e,n)}}function E(e){j(O(e),e)}function w(e,t){if(!e.__vdom&&t){var n=t.functions;if(e.children.length>0&&e.children[0].attributes&&e.children[0].attributes.class&&"-shadow-root"===e.children[0].attributes.class.value){var r=e.children[1];r&&"-original-root"===r.className&&(e.__i=r.innerHTML,T(r,e),r.parentNode.removeChild(r)),e.isRendered=!0}else e.__i=e.ownerDocument?e.innerHTML:m(e),T(e),e.innerHTML='<div class="-shadow-root"></div>',e.isRendered=!1;o("--zino-initialize-node",{tag:e,node:n}),e.__vdom={};var a=!e.isRendered&&O.call(this,e)||{events:[]},i=[],c=n.events||[],s=Object.keys(c).filter(function(t){var n=":host"!==t&&t!==e.tagName;return n||i.push({handlers:c[t],selector:t}),n}).map(function(e){return{selector:e,handlers:c[e]}});if(a.events=a.events.concat({childEvents:s,hostEvents:i,tag:this&&this.noEvents?e.tagName:e}),e.attributes.__ready||N(e,"__ready",!0),this&&!0===this.noEvents)return a;j(a,e)}}function N(e,t,n){M(e.__s)?e.__s===e.setAttribute?HTMLElement.prototype.setAttribute.call(e,t,n):e.__s(t,n):e.ownerDocument?HTMLElement.prototype.setAttribute.call(e,t,n):e.attributes[t]={name:t,value:n}}function A(t){var n=t.tag,r=t.node,a=void 0===r?J:r;for(var i in a){var c=a[i];["mount","unmount","events","render"].indexOf(i)<0&&(M(c)?n[i]=c.bind(n):n[i]=S(n[i])?e({},c,n[i]):c)}var s=Object.getOwnPropertyDescriptor(n,"body");s&&void 0!==s.get||Object.defineProperty(n,"body",{set:function(e){n.__i=e,T(n),o("--zino-rerender-tag",n.getHost())},get:function(){return n.__i}}),n.__s=n.setAttribute,n.setAttribute=function(e,t){N(this,e,t),o("--zino-rerender-tag",this)},n.props=e({},a.props,C(n,!0)),n.attrs=C(n);try{n.mounting=!0,a.mount.call(n),delete n.mounting}catch(e){throw new Error("Unable to call mount function for "+n.tagName+": "+(e.message||e))}}function O(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P[t.tagName.toLowerCase()],r=[],o=[],a=[],i=void 0;l(Z.resolveData),g();var c=C(t);if(!M(n.render))throw new Error("No render function provided in component "+t.tagName);p(Object.keys(P)),i=f("div",{class:"-shadow-root"},n.render.call(t,c)),t.__subs&&t.__subs.forEach(L),a=h();for(var s=0,u=a.length;s<u;s+=1){var d=a[s],v=w.call({noRenderCallback:!0,noEvents:!0},d,P[d.tagName]);v&&(a.splice.apply(a,[s+1,0].concat(v.subElements)),s+=v.subElements.length,u+=v.subElements.length,r=r.concat(v.events),o=o.concat(v.renderCallbacks))}return t.attributes.__ready&&Math.abs(i.__complexity-(t.__complexity||0))<50&&t.ownerDocument?y(t.children[0],i,t.ownerDocument):t.ownerDocument?t.children[0].innerHTML=m(i):t.children[0]=i,t.__subs=a,t.__vdom=i,t.__complexity=i.__complexity,a.length>0&&(t.querySelectorAll&&[].slice.call(t.querySelectorAll("[__ready]"))||[]).forEach(function(t,n){e(t,a[n]),t.getHost=a[n].getHost=J.getHost.bind(t)}),t.isRendered=!0,this&&this.noRenderCallback?o.push({fn:n.functions.render,tag:t}):(o.forEach(function(e){return e.fn.call(e.tag.getHost())}),n.functions.render.call(t)),{events:r,renderCallbacks:o,data:c,subElements:a}}function j(e,t){var n={};t.addEventListener.toString().indexOf("[native code]")>=0&&e.events.forEach(function(e){var r=e.tag;S(r)||(n[r]=(n[r]||0)+1,r=t.querySelectorAll(r)[n[r]-1]),r.children[0].__eventsAttached||(s(r.children[0],e.childEvents,r),s(r,e.hostEvents,r),r.children[0].__eventsAttached=!0)}),[t].concat(t.__subs).forEach(function(e){var t=e&&e.getHost()||{};M(t.onready)&&t.onready.call(t)})}function L(e){var t=(e.tagName||"").toLowerCase(),n=P[t];if(n){[].forEach.call(1===e.nodeType&&e.attributes||Object.keys(e.attributes).map(function(t){return e.attributes[t]}),function(e){e.name.indexOf("data-")>=0&&delete B[e.value]});try{n.functions.unmount.call(e)}catch(e){throw new Error("Unable to unmount tag "+t+": "+(e.message||e))}}}function C(e,t){var n={props:e.props,element:e.element,styles:e.styles,body:e.__i},r=n.props;return[].forEach.call(1===e.nodeType&&e.attributes||Object.keys(e.attributes).map(function(t){return e.attributes[t]}),function(e){var t=e.name.indexOf("data-")>=0&&"string"==typeof e.value&&"--"===e.value.substr(0,2),o=e.value;n[e.name]||(n[e.name]=t&&"string"==typeof o&&B[o.replace(/^--|--$/g,"")]||o),0===e.name.indexOf("data-")&&(r[e.name.replace(/^data-/g,"").replace(/(\w)-(\w)/g,function(e,t,n){return t+n.toUpperCase()})]=n[e.name])}),t?r:n}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n={};[].forEach.call(e.children,function(e){if(e.tagName){var t=e.tagName.toLowerCase();n[t]?(n[t].isArray||(n[t]=[n[t]],n[t].isArray=!0),n[t].push(e)):n[t]=e}}),t.element=n}function H(e){var t=e.tagName;o("publish-style",{styles:(e.styles||[]).map(function(e){return e.replace(/[\r\n]*([^%\{;\}]+?)\{/gm,function(e,n){if(n.trim().match(/^@/))return n+"{";var r=n.split(",").map(function(e){return e=e.trim(),e.match(/:host\b/)||e.match(new RegExp("^\\s*"+t+"\\b"))||e.match(/^\s*(?:(?:\d+%)|(?:from)|(?:to)|(?:@\w+)|\})\s*$/)?e:t+" "+e});return e.replace(n,r.join(","))}).replace(/:host\b/gm,t)+"\n"}).join("\n"),tagName:t})}function k(e){function t(){return"data"+(0===d?"":"$"+d)}function n(e,n){var r=void 0,o="",a=0,i=n?" + ":", ";if(!e.match(X))return o+="'"+e.substr(a).replace(/\n/g,"").replace(/'/g,"\\'")+"'"+i;for(;r=X.exec(e);)if(!(r.index<a)){var l=e.substring(a,r.index).replace(/^\s+/g,"");l.length>0&&(o+="'"+l.replace(/\n/g,"").replace(/'/g,"\\'")+"'"+i),a=r.index+r[0].length;var f=r[1],p=f.substr(1);if("#"===f[0])o+="spread(toArray("+t()+", '"+p+"').map(function (e, i, a) {\n\t\t\t\t\t\tvar data$"+(d+1)+" = merge({}, data"+(0>=d?"":"$"+d)+", {'.': e, '.index': i, '.length': a.length}, e);\n\t\t\t\t\t\treturn [].concat(",d+=1,c=!0,u=!0;else if("/"===f[0]){if(o+="''); }))"+(n?'.join("")':"")+i,(d-=1)<0)throw new Error("Unexpected end of block: "+f.substr(1))}else"^"===f[0]?(o+="(safeAccess("+t()+", '"+p+"') && (typeof safeAccess("+t()+", '"+p+"') === 'boolean' || safeAccess("+t()+", '"+p+"').length > 0)) ? '' : spread([1].map(function() { var data$"+(d+1)+" = merge({}, data"+(0>=d?"":"$"+d)+"); return [].concat(",u=!0,d+=1):"%"===f[0]?(o+=f.substr(1).split(/\s*,\s*/).map(function(e){return"renderStyle(safeAccess("+t()+", '"+e+"'), "+t()+")"}).join(" + "),s=!0):"+"===f[0]?o+="safeAccess("+t()+", '"+p+"')"+i:"{"!==f[0]&&"!"!==f[0]?(p=f,o+="''+safeAccess("+t()+", '"+p+"', true)"+i):"!"!==f[0]&&(o+="''+safeAccess("+t()+", '"+p+"')"+i)}return e.substr(a).length>0&&(o+="'"+e.substr(a).replace(/\n/g,"").replace(/'/g,"\\'")+"'"+i),o}var r={styles:[],helperFunctions:[K],tagName:"",render:"",functions:[]},c=!1,s=!1,u=!1,l=void 0,f=0,d=0,p=[];if(a("--zino-addscript",function(e){e=e.trim().replace(/;$/,"").replace(/(['"`])([^\1\n]*)\1/gm,function(e,t,n){return e.replace(n,n.replace(/\/\//g,"\\/\\/"))}).replace(/\/\/.*$/gm,""),e.trim()&&(r.functions.push(e),c=!0)}),e=e.replace(V,"").replace(/<(script|style)(\s+[^>]*?)?>((?:.|\n)*?)<\/\1>/gi,function(e,t,n,a){return"style"===t?r.styles.push(a):n&&n.match(/\s+src=(?:(?:'([^']+)')|(?:"([^"]+)"))/g)?o("publish-script",RegExp.$1||RegExp.$2):o("--zino-addscript",a),""}).trim(),i("--zino-addscript"),!e.match(G))throw new Error("No proper component provided");for(r.tagName=e.match(/^<([\w_-]+)>/)[1].toLowerCase();l=G.exec(e);)if(!(l.index<f)){var g=e.substring(f,l.index).replace(/^[ \t]+|[ \t]$/g," ").trim();if(f=l.index+l[0].length,g.length>0&&(r.render+=n(g)),l[2]!==r.tagName)if(l[1]){var h=p.pop();if(h!==l[2])throw new Error("Unexpected end of tag: "+l[2]+"; expected to end "+h);r.render=r.render.replace(/,\s*$/g,"")+")), "}else{p.push(l[2]);var m=function(e){for(var t="{",r=void 0;r=I.exec(e);)"{"!==t&&(t+=", "),t+='"'+r[1].toLowerCase()+'": '+n(r[2]||r[3]||"",!0).replace(/\s*[,+]\s*$/g,"");return t+"}"}(l[3]);r.render+="new Tag('"+l[2]+"', "+m,l[4]?(r.render+="), ",p.pop()):r.render+=", [].concat("}}if(p.length>0)throw new Error("Unclosed tags: "+p.join(", "));if(d>0)throw new Error("Unexpected end of block");return e.substr(f).trim().length>0&&(r.render+=n(e.substr(f).replace(/^[ \t]+|[ \t]$/g," ").trim())),r.render=r.render.replace(/,\s*$/g,""),c&&(r.helperFunctions.push(Y),r.helperFunctions.push(Q)),u&&r.helperFunctions.push(W),s&&r.helperFunctions.push(ee),r.functions=r.functions.length>0?"merge({}, "+(r.functions.join(", ")||"{}")+")":"{}",r.styles=r.styles.length>0?"styles: "+JSON.stringify(r.styles)+",":"",r.helperFunctions=r.helperFunctions.join("\n"),te.replace(/\{\{([^\}]+)\}\}/g,function(e,t){return r[t]})}function $(e,t){return[].slice.call(t.querySelectorAll(e))}var z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S=function(e){return"object"===(void 0===e?"undefined":z(e))},M=function(e){return"function"==typeof e},F=function(){},R={},q=[],D=[],U=function(e,t){return e},Z={resolveData:function(e,t,r){var o=n();return r&&delete B[r],B[o]=t,o}},P={},B={},J={props:{},mount:F,unmount:F,render:F,getHost:function(){return this},setProps:function(t,n){var r=this.getHost();if(S(t))e(r.props,t);else{r.props[t]=n;var a="data-"+t.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()});r.attributes[a]&&N(r,a,"--"+Z.resolveData(t,n,r.attributes[a].value)+"--")}!r.mounting&&o("--zino-rerender-tag",r)}};a("--zino-initialize-node",A),a("--zino-unmount-tag",L),a("--zino-mount-tag",_);var G=/<(\/?)([\w-]+)([^>]*?)(\/?)>/g,I=/([\w_-]+)(?:=(?:'([^']*?)'|"([^"]*?)"))?/g,V=/<!--(?:[^-]|-[^-])*-->/g,X=/\{\{\s*([^\}]+)\s*\}\}\}?/g,K='function safeAccess(t,e,r){if(!e)return t;if("."===e[0])return t[e];for(e=e.split(".");e.length>0&&void 0!==(t=t[e.shift()]););return"string"==typeof t&&r===!0?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/>/g,"&gt;"):"function"==typeof t?t.call(__i):"number"==typeof t?t:t||""}',Q='function toArray(t,e){var r=safeAccess(t,e);return r?"[object Array]"===Object.prototype.toString.call(r)?r:"function"==typeof r?r():[r]:[]}',W="function spread(t){var e=[];return t.forEach(function(t){e=e.concat(t)}),e}",Y="function merge(t){return[].slice.call(arguments,1).forEach(function(e){for(var r in e)t[r]=e[r]}),t}",ee='function renderStyle(t,r){var e="";if(transform=function(t){return"function"==typeof t?transform(t.apply(r)):t+("number"==typeof t&&null!==t?r.styles&&r.styles.defaultUnit||"px":"")},"object"==typeof t)for(var n in t)e+=n.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})+":"+transform(t[n])+";";return e}',te='function (Tag,Zino){var __i;{{helperFunctions}};return{tagName:"{{tagName}}",{{styles}}render:function(data){return __i=this,[].concat({{render}})},functions:{{functions}}}}',ne=window.zinoTagRegistry||{},re=void 0,oe=[],ae=new MutationObserver(function(e){e.forEach(function(e){var t=e.addedNodes,n=e.removedNodes;t.length>0?[].forEach.call(t,function(e){return o("--zino-mount-tag",e)}):n.length>0&&[].forEach.call(n,function(e){(e.children&&$("[__ready]",e)||[]).concat(e).forEach(function(e){return o("--zino-unmount-tag",e)})})})}),ie=re={on:a,one:c,off:i,trigger:o,fetch:function(e,t,n,r){if(n&&ne[e]&&!ne[e].callback)return t(ne[e],200);if(S(ne[e]))return ne[e].callback.push(t);if(ne[e]=r||{callback:[t]},!r){var o=new XMLHttpRequest;o.open("GET",e,!0),o.onreadystatechange=function(){if(4===o.readyState){var t=ne[e].callback;200===o.status&&(ne[e]=o.responseText),n||delete ne[e],t.forEach(function(e){return e(o.responseText,o.status)})}},o.send()}},import:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F,n=function(e){e&&x(e,document.body,re),t()},r=(this.path||"")+e;if("string"!=typeof e)return n(e);re.fetch(r,function(e,t){var o=r.replace(/[^\/]+$/g,"");if(200===t){var a=void 0;try{0===e.trim().indexOf("<")&&(e=k(e)),a=new Function("return "+e.replace(/url\((\\*['"])?(.*?)\1\)/g,function(e,t,n){return 0===n.indexOf("data:")||0===n.indexOf("http")||0===n.indexOf("//")||0===n.indexOf("/")?e:"url("+o+n+")"}).replace(/\bZino.import\s*\(/g,"Zino.import.call({path: "+JSON.stringify(o)+"}, ").trim().replace(/;$/,""))()}catch(e){throw e.message="Unable to import tag "+r.replace(/.*\//g,"")+": "+e.message,e}n(a)}},!0)}};return window.Zino=re,a("publish-style",function(e){if("string"==typeof e.tagName&&e.styles.length>0){if(document.getElementById("style:"+e.tagName))return;var t=document.createElement("style");t.innerHTML=e.styles,t.id="style:"+e.tagName,document.head.appendChild(t)}}),a("--zino-rerender-tag",function(e){return oe.indexOf(e)<0&&oe.push(e)}),o("publish-style","[__ready] { contain: content; }"),$('[rel="zino-tag"]',document).forEach(function(e){return re.import(e.href)}),ae.observe(document.body,{subtree:!0,childList:!0}),requestAnimationFrame(function e(){for(;oe.length>0;)E(oe.shift());requestAnimationFrame(e)}),ie}();
//# sourceMappingURL=zino.min.js.map