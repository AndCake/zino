{"version":3,"file":"zino.js","sources":["src/utils.js","src/events.js","src/mustacheparser.js","src/browser.js","src/vdom.js","src/core.js","src/facade.js","src/zino-light.js","src/zino.js"],"sourcesContent":["/**\n * Merges all objects provided as parameters into the first parameter object\n *\n * @param  {...Object} args list of arguments\n * @return {Object}         the merged object (same as first argument)\n */\nexport function merge (target, ...args) {\n\tfor (let arg, len = args.length, index = 0; arg = args[index], index < len; index += 1) {\n\t\tfor (let all in arg) {\n\t\t\tif ((typeof HTMLElement !== 'undefined' && arg instanceof HTMLElement) || typeof propDetails(arg, all).value !== 'undefined' && (!target[all] || propDetails(target, all).writable)) {\n\t\t\t\tif (all !== 'attributes') target[all] = arg[all];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn target;\n}\n\nfunction propDetails(obj, attribute) {\n\treturn isObj(obj) && Object.getOwnPropertyDescriptor(obj, attribute) || {};\n}\n\n/**\n * Creates a diff of two JS objects. Includes attribute position check.\n *\n * @param  {Object} objA\tthe object to be compared\n * @param  {Object} objB \tthe object to compare with\n * @return {Object,Boolean} false if both objects are deep equal, else the values of what is different\n */\nexport function objectDiff(objA, objB) {\n\tlet result = {},\n\t\tpartialDiff;\n\n\tif (!objA) return objB || false;\n\tif (!objB) return objA || false;\n\tObject.keys(objA).forEach((key, index) => {\n\t\tif (['__vdom', 'element', 'parentNode', 'innerHTML', 'outerHTML', 'className'].indexOf(key) >= 0 || isFn(objA[key])) return;\n\t\tif (typeof objB[key] === 'undefined') {\n\t\t\tresult[key] = objA[key];\n\t\t} else if (Object.keys(objB)[index] !== key) {\n\t\t\tlet bKey = Object.keys(objB)[index];\n\t\t\tresult[bKey] = objB[bKey];\n\t\t\tresult[key] = objA[key];\n\t\t} else if (typeof objA[key] !== 'object' || typeof objB[key] !== 'object') {\n\t\t\tif (objA[key] !== objB[key]) {\n\t\t\t\tresult[key] = objB[key];\n\t\t\t}\n\t\t} else if (partialDiff = objectDiff(objA[key], objB[key])) {\n\t\t\tresult[key] = partialDiff;\n\t\t}\n\t});\n\tObject.keys(objB).forEach((key, index) => {\n\t\tif (['__vdom', 'element', 'parentNode', 'innerHTML', 'outerHTML', 'className'].indexOf(key) >= 0 || isFn(objB[key])) return;\n\t\tif (typeof objA[key] === 'undefined') {\n\t\t\tresult[key] = objB[key];\n\t\t}\n\t});\n\tif (Object.keys(result).length > 0) return result;\n\treturn false;\n}\n\nexport function error(method, tag, parentException) {\n\tif (!parentException) {\n\t\tparentException = tag;\n\t}\n\tparentException.message = 'Error while calling ' + method + (parentException !== tag ? ' function of ' + tag : '') + ': ' + (parentException.message || parentException);\n\tthrow parentException;\n}\n\n/**\n * Checks if the given arguments are the provided types, if they do no match, an exception is thrown.\n *\n * @param  {Array} args \tlist of arguments provided to callee\n * @param  {Array} types \tlist of data types expected for the provided arguments\n * @param  {String} api  \tname of the API (callee name)\n */\nexport function checkParams(args, types, api) {\n\tfor (var all in args) {\n\t\tif (types[all] && typeof args[all] !== types[all]) {\n\t\t\tthrow new Error('API mismatch while using ' + api + ': Parameter ' + all + ' was supposed to be ' + types[all] + ' but ' + (typeof args[all]) + ' was given.');\n\t\t}\n\t}\n}\n\n/**\n * makes sure that accessing attributes on an unknown data value is safe\n *\n * @param  {Mixed} obj \tdata to made safe for attribute access\n * @return {Object}     will always return an object\n */\nexport function safeAccess(obj) {\n\treturn obj || {};\n}\n\nexport function uuid() {\n\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\n\t\tlet r = Math.random() * 16 | 0;\n\t\treturn (c == 'x' ? r : r & 0x3 | 0x8).toString(16);\n\t});\n}\n\nexport function toArray(obj, startIdx) {\n\treturn Array.prototype.slice.call(obj, startIdx || 0);\n}\n\nexport var isObj = obj => typeof obj === 'object';\nexport var isFn = fn => typeof fn === 'function';\nexport var emptyFunc = () => {};\nexport var identity = a => a;\n\nexport function isValue(obj, key) {\n\tlet descriptor = Object.getOwnPropertyDescriptor(obj, key);\n\treturn typeof descriptor.value !== 'undefined' && !isFn(descriptor.value);\n}\n","import {isFn} from './utils';\n\nlet eventQueue = {};\n\nfunction publishEvent(type, data) {\n\tdata.name.indexOf('--event-') && trigger('--event-' + type, data);\n}\n\nexport function trigger(name, data) {\n\tpublishEvent('trigger', {name, data});\n\tif (!eventQueue[name]) return;\n\tfor (let index in eventQueue[name]) {\n\t\tlet result = eventQueue[name][index](data);\n\t\tif (result === false) break;\n\t}\n}\n\nexport function on(name, fn) {\n\tif (!eventQueue[name]) {\n\t\teventQueue[name] = [];\n\t}\n\teventQueue[name].push(fn);\n\tpublishEvent('register', {name, fn});\n}\n\nexport function off(name, fn) {\n\tif (!isFn(fn)) {\n\t\tdelete eventQueue[name];\n\t\treturn publishEvent('unregister', {name});\n\t}\n\tfor (let index in eventQueue[name]) {\n\t\tif (eventQueue[name][index] === fn) {\n\t\t\tdelete eventQueue[name][index];\n\t\t\treturn publishEvent('unregister', {name, fn});\n\t\t}\n\t}\n}\n\nexport function one(name, fn) {\n\ton(name, function self() {\n\t\tfn.apply(this, arguments);\n\t\toff(name, self);\n\t});\n}\n","import {trigger, on, off} from './events';\n\nconst tagRegExp = /<(\\/?)([\\w-]+)([^>]*?)(\\/?)>/g;\nconst attrRegExp = /([\\w_-]+)(?:=(?:'([^']*?)'|\"([^\"]*?)\"))?/g;\nconst commentRegExp = /<!--(?:[^-]|-[^-])*-->/g;\nconst syntax = /\\{\\{\\s*([^\\}]+)\\s*\\}\\}\\}?/g;\n\n/* helper functions to be used inside the generated code */\n\n/** @function safeAccess\n * safely access the given property in the object obj.\n *\n * @param obj (Object) - the object to read the property from\n * @param attrs (String) - the name of the property to access (allows for object paths via ., e.g. \"myprop.firstValue\")\n * @param escape (Boolean) - if the value should be HTML escaped to prevent XSS attacks and such\n * @return any\n */\nconst safeAccess = 'function safeAccess(t,e,r){if(!e)return t;if(\".\"===e[0])return t[e];for(e=e.split(\".\");e.length>0&&void 0!==(t=t[e.shift()]););return\"string\"==typeof t&&r===!0?t.replace(/&/g,\"&amp;\").replace(/</g,\"&lt;\").replace(/\"/g,\"&quot;\").replace(/>/g,\"&gt;\"):\"function\"==typeof t?t.call(__i):\"number\"==typeof t?t:t||\"\"}'/*`function safeAccess(obj, attrs, escape) {\n\tif (!attrs) return obj;\n\tif (attrs[0] === '.') {\n\t\treturn obj[attrs];\n\t}\n\tattrs = attrs.split('.');\n\twhile (attrs.length > 0 && typeof (obj = obj[attrs.shift()]) !== 'undefined');\n\tif (typeof obj === 'string' && escape === true) {\n\t\treturn obj.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/\"/g, '&quot;').replace(/>/g, '&gt;');\n\t} else if (typeof obj === 'function') {\n\t\treturn obj.call(instance);\n\t} else {\n\t\treturn typeof obj === 'number' ? obj : (obj || '');\n\t}\n}`*/;\n\n/** @function toArray\n * turn property value of an object into an array\n *\n * @param data (Object) - the object to read the property value from\n * @param value (String) - the property whose value should be read from the object\n * @return Array\n */\nconst toArray = 'function toArray(t,e){var r=safeAccess(t,e);return r?\"[object Array]\"===Object.prototype.toString.call(r)?r:\"function\"==typeof r?r():[r]:[]}'/*`function toArray(data, value) {\n\tvar dataValue = safeAccess(data, value);\n\tif (dataValue) {\n\t\tif (Object.prototype.toString.call(dataValue) === '[object Array]') {\n\t\t\treturn dataValue;\n\t\t} else if (typeof dataValue === 'function') {\n\t\t\treturn dataValue();\n\t\t} else return [dataValue];\n\t} else {\n\t\treturn [];\n\t}\n}`*/;\n\n/** @function spread\n * turns an array of arrays into an array of all containing elements (reduces the array depth by 1)\n *\n * @param array (Array) - the array to spread the values along\n * @return Array - a new array containing all the values of the sub elements\n */\nconst spread = 'function spread(t){var e=[];return t.forEach(function(t){e=e.concat(t)}),e}'/*`function spread(array) {\n\tvar result = [];\n\tarray.forEach(function(entry) {\n\t\tresult = result.concat(entry);\n\t});\n\treturn result;\n}`*/;\n\n/** @function merge\n * merges any number of objects into the target object\n * @param target (Object) - the object the other object should be merged into\n * @param obj1 (Object) - the first object to be merged into the target object\n * @param objn (Object) - all nth object to be merged into the target object\n * @return Object - the target object\n */\nconst merge = 'function merge(t){return[].slice.call(arguments,1).forEach(function(e){for(var r in e)t[r]=e[r]}),t}'/*`function merge(target) {\n\t[].slice.call(arguments, 1).forEach(function (arg) {\n\t\tfor (var all in arg) {\n\t\t\ttarget[all] = arg[all];\n\t\t}\n\t});\n\n\treturn target;\n}`*/;\n\n/** @function renderStyle\n * transforms an object into CSS properties\n *\n * @param value (Object) - the object to be transformed\n * @param context (Object) - for any functions defined in the object, context will be provided within as `this`\n * @return String - the CSS property list separated by semicolon\n */\nconst renderStyle = 'function renderStyle(t,r){var e=\"\";if(transform=function(t){return\"function\"==typeof t?transform(t.apply(r)):t+(\"number\"==typeof t&&null!==t?r.styles&&r.styles.defaultUnit||\"px\":\"\")},\"object\"==typeof t)for(var n in t)e+=n.replace(/[A-Z]/g,function(t){return\"-\"+t.toLowerCase()})+\":\"+transform(t[n])+\";\";return e}'/*`function renderStyle(value, context) {\n\tvar style = '';\n\t\ttransform = function(val) {\n\t\t\tif (typeof val === 'function') return transform(val.apply(context));\n\t\t\treturn val + (typeof val === 'number' && val !== null ? context.styles && context.styles.defaultUnit || 'px' : '');\n\t\t};\n\n\tif (typeof value === 'object') {\n\t\tfor (var all in value) {\n\t\t\tstyle += all.replace(/[A-Z]/g, function(g){ return '-' + g.toLowerCase()}) + ':' + transform(value[all]) + ';';\n\t\t}\n\t}\n\n\treturn style;\n}`*/;\n\n/* this is the base structure of a Zino tag */\nconst baseCode = 'function (Tag,Zino){var __i;{{helperFunctions}};return{tagName:\"{{tagName}}\",{{styles}}render:function(data){return __i=this,[].concat({{render}})},functions:{{functions}}}}'/*`function(Tag, Zino) {\n\tvar instance = null;\n\t{{helperFunctions}}\n\n\treturn {\n\t\ttagName: '{{tagName}}',\n\t\t{{styles}}\n\t\trender: function(data) {\n\t\t\tinstance = this;\n\t\t\treturn [].concat({{render}})\n\t\t},\n\n\t\tfunctions: {{functions}}\n\t};\n}`*/;\n\n/** parses style information from within a style tag makes sure it is localized */\nfunction handleStyles(tagName, styles) {\n\tstyles = (styles || []).map(style => {\n\t\t\tlet code = style;\n\t\t\treturn code.replace(/[\\r\\n]*([^%\\{;\\}]+?)\\{/gm, (global, match) => {\n\t\t\t\tif (match.trim().match(/^@/)) {\n\t\t\t\t\treturn match + '{';\n\t\t\t\t}\n\t\t\t\tvar selectors = match.split(',').map(selector => {\n\t\t\t\t\tselector = selector.trim();\n\t\t\t\t\tif (selector.match(/:host\\b/) ||\n\t\t\t\t\t\tselector.match(new RegExp(`^\\\\s*${tagName}\\\\b`)) ||\n\t\t\t\t\t\tselector.match(/^\\s*(?:(?:\\d+%)|(?:from)|(?:to)|(?:@\\w+)|\\})\\s*$/)) {\n\t\t\t\t\t\treturn selector;\n\t\t\t\t\t}\n\t\t\t\t\treturn tagName + ' ' + selector;\n\t\t\t\t});\n\t\t\t\treturn global.replace(match, selectors.join(','));\n\t\t\t}).replace(/:host\\b/gm, tagName) + '\\n';\n\t\t});\n\treturn styles;\n}\n\n/** takes an HTML string containing mustache code and turns it into executable JS code that generates a vdom */\nexport function parse(data) {\n\tlet resultObject = {\n\t\tstyles: [],\n\t\thelperFunctions: [safeAccess],\n\t\ttagName: '',\n\t\trender: '',\n\t\tfunctions: []\n\t};\n\tlet usesMerge = false, usesRenderStyle = false, usesSpread = false;\n\tlet match, lastIndex = 0, level = 0, tagStack = [];\n\n\t// return the correct data level for multi-level mustache blocks\n\tfunction getData() {\n\t\treturn `data${level === 0 ? '' : '$' + level}`;\n\t}\n\n\t// text is the only place where mustache code can be found\n\tfunction handleText(text, isAttr) {\n\t\tlet match, result = '', lastIndex = 0;\n\t\tlet cat = isAttr ? ' + ' : ', ';\n\t\tif (!text.match(syntax)) {\n\t\t\treturn result += \"'\" + text.substr(lastIndex).replace(/\\n/g, '').replace(/'/g, '\\\\\\'') + \"'\" + cat;\n\t\t}\n\t\t// locate mustache syntax within the text\n\t\twhile (match = syntax.exec(text)) {\n\t\t\tif (match.index < lastIndex) continue;\n\t\t\tlet frag = text.substring(lastIndex, match.index).replace(/^\\s+/g, '');\n\t\t\tif (frag.length > 0) {\n\t\t\t\tresult += \"'\" + frag.replace(/\\n/g, '').replace(/'/g, '\\\\\\'') + \"'\" + cat;\n\t\t\t}\n\t\t\tlastIndex = match.index + match[0].length;\n\t\t\tlet key = match[1];\n\t\t\t// of \"{{#test}}\" value will be \"test\"\n\t\t\tlet value = key.substr(1);\n\t\t\tif (key[0] === '#') {\n\t\t\t\t// handle block start\n\t\t\t\tresult += `spread(toArray(${getData()}, '${value}').map(function (e, i, a) {\n\t\t\t\t\t\tvar data$${level + 1} = merge({}, data${0 >= level ? '' : '$' + level}, {'.': e, '.index': i, '.length': a.length}, e);\n\t\t\t\t\t\treturn [].concat(`;\n\t\t\t\tlevel += 1;\n\t\t\t\tusesMerge = true;\n\t\t\t\tusesSpread = true;\n\t\t\t} else if (key[0] === '/') {\n\t\t\t\t// handle block end\n\t\t\t\tresult += '\\'\\'); }))' + (isAttr ? '.join(\"\")' : '') + cat;\n\t\t\t\tlevel -= 1;\n\t\t\t\tif (level < 0) {\n\t\t\t\t\tthrow new Error('Unexpected end of block: ' + key.substr(1));\n\t\t\t\t}\n\t\t\t} else if (key[0] === '^') {\n\t\t\t\t// handle inverted block start\n\t\t\t\tresult += `(safeAccess(${getData()}, '${value}') && (typeof safeAccess(${getData()}, '${value}') === 'boolean' || safeAccess(${getData()}, '${value}').length > 0)) ? '' : spread([1].map(function() { var data$${level + 1} = merge({}, data${0 >= level ? '' : '$' + level}); return [].concat(`;\n\t\t\t\tusesMerge = true;\n\t\t\t\tusesSpread = true;\n\t\t\t\tlevel += 1;\n\t\t\t} else if (key[0] === '%') {\n\t\t\t\t// handle style rendering \"{{%myvar}}\" - only to be used for attribute values!\n\t\t\t\tresult += key.substr(1).split(/\\s*,\\s*/).map(value => `renderStyle(safeAccess(${getData()}, '${value}'), ${getData()})`).join(' + ');\n\t\t\t\tusesRenderStyle = true;\n\t\t\t} else if (key[0] === '+') {\n\t\t\t\t// handle deep data transfer \"{{+myvar}}\"\n\t\t\t\tresult += `safeAccess(${getData()}, '${value}')${cat}`;\n\t\t\t} else if (key[0] !== '{' && key[0] !== '!') {\n\t\t\t\t// handle non-escaping prints \"{{{myvar}}}\"\n\t\t\t\tvalue = key;\n\t\t\t\tresult += `''+safeAccess(${getData()}, '${value}', true)${cat}`\n\t\t\t} else if (key[0] !== '!') {\n\t\t\t\t// regular prints \"{{myvar}}\"\n\t\t\t\tresult += `''+safeAccess(${getData()}, '${value}')${cat}`;\n\t\t\t} // ignore comments\n\t\t}\n\t\tif (text.substr(lastIndex).length > 0) {\n\t\t\tresult += \"'\" + text.substr(lastIndex).replace(/\\n/g, '').replace(/'/g, '\\\\\\'') + \"'\" + cat;\n\t\t}\n\t\treturn result;\n\t}\n\n\t// generate attribute objects for vdom creation\n\tfunction makeAttributes(attrs) {\n\t\tlet attributes = '{';\n\t\tlet attr;\n\n\t\twhile ((attr = attrRegExp.exec(attrs))) {\n\t\t\tif (attributes !== '{') attributes += ', ';\n\t\t\tattributes += '\"' + attr[1].toLowerCase() + '\": ' + handleText(attr[2] || attr[3] || '', true).replace(/\\s*[,+]\\s*$/g, '');\n\t\t}\n\t\treturn attributes + '}';\n\t}\n\n \t// clean up code\n\ton('--zino-addscript', content => {\n\t\tcontent = content.trim().replace(/;$/,'').replace(/(['\"`])([^\\1\\n]*)\\1/gm, (g,m,c) => g.replace(c, c.replace(/\\/\\//g, '\\\\/\\\\/'))).replace(/\\/\\/.*$/gm, '');\n\t\tif (content.trim()) {\n\t\t\tresultObject.functions.push(content);\n\t\t\tusesMerge = true;\n\t\t}\n\t});\n\t// handle all scripts and styles\n\tdata = data.replace(commentRegExp, '').replace(/<(script|style)(\\s+[^>]*?)?>((?:.|\\n)*?)<\\/\\1>/gi, (g, x, a, m) => {\n\t\tif (x === 'style') {\n\t\t\tresultObject.styles.push(m);\n\t\t} else {\n\t\t\tif (a && a.match(/\\s+src=(?:(?:'([^']+)')|(?:\"([^\"]+)\"))/g)) {\n\t\t\t\ttrigger('publish-script', RegExp.$1 || RegExp.$2);\n\t\t\t} else {\n\t\t\t\ttrigger('--zino-addscript', m);\n\t\t\t}\n\t\t}\n\t\treturn '';\n\t}).trim();\n\toff('--zino-addscript');\n\n\t// check if we have an actual HTML component code (looking for the starting tag)\n\tif (!data.match(tagRegExp)) {\n\t\tthrow new Error('No proper component provided');\n\t}\n\t// find out how the component is called\n\tresultObject.tagName = data.match(/^<([\\w_-]+)>/)[1].toLowerCase();\n\tresultObject.styles = handleStyles(resultObject.tagName, resultObject.styles);\n\n\t// loop through all HTML tags in code\n\twhile (match = tagRegExp.exec(data)) {\n\t\t// skip the ones we already processed\n\t\tif (match.index < lastIndex) continue;\n\t\tlet text = data.substring(lastIndex, match.index).replace(/^[ \\t]+|[ \\t]$/g, ' ').trim();\n\t\tlastIndex = match.index + match[0].length;\n\t\t// if we have some leading text (before the first tag)\n\t\tif (text.length > 0) {\n\t\t\t// it must be a text node\n\t\t\tresultObject.render += handleText(text);\n\t\t}\n\t\t// if we found the tag's definition, skip it\n\t\tif (match[2] === resultObject.tagName) continue;\n\t\tif (match[1]) {\n\t\t\t// closing tag\n\t\t\tlet expected = tagStack.pop();\n\t\t\tif (expected !== match[2]) {\n\t\t\t\tthrow new Error('Unexpected end of tag: ' + match[2] + '; expected to end ' + expected);\n\t\t\t}\n\t\t\tresultObject.render = resultObject.render.replace(/,\\s*$/g, '') + ')), ';\n\t\t} else {\n\t\t\t// opening tag\n\t\t\ttagStack.push(match[2]);\n\t\t\tlet attributes = makeAttributes(match[3]);\n\t\t\tresultObject.render += `Tag('${match[2]}', ${attributes}`;\n\t\t\tif (!match[4]) {\n\t\t\t\t// not a self-closing tag, so prepare for it's content\n\t\t\t\tresultObject.render += ', [].concat(';\n\t\t\t} else {\n\t\t\t\t// self-closing tag, close it immediately\n\t\t\t\tresultObject.render += '), ';\n\t\t\t\ttagStack.pop();\n\t\t\t}\n\t\t}\n\t}\n\tif (tagStack.length > 0) {\n\t\tthrow new Error('Unclosed tags: ' + tagStack.join(', '));\n\t}\n\tif (level > 0) {\n\t\tthrow new Error('Unexpected end of block');\n\t}\n\t// if we have content after the last found tag node\n\tif (data.substr(lastIndex).trim().length > 0) {\n\t\t// it must be a text node\n\t\tresultObject.render += handleText(data.substr(lastIndex).replace(/^[ \\t]+|[ \\t]$/g, ' ').trim());\n\t}\n\tresultObject.render = resultObject.render.replace(/,\\s*$/g, '');\n\n\t// add helper functions that were used by the code\n\tif (usesMerge) {\n\t\tresultObject.helperFunctions.push(merge);\n\t\tresultObject.helperFunctions.push(toArray);\n\t}\n\tif (usesSpread) {\n\t\tresultObject.helperFunctions.push(spread);\n\t}\n\tif (usesRenderStyle) {\n\t\tresultObject.helperFunctions.push(renderStyle);\n\t}\n\tif (resultObject.functions.length > 0) {\n\t\tresultObject.functions = 'merge({}, ' + (resultObject.functions.join(', ') || '{}') + ')';\n\t\tif (!usesMerge) {\n\t\t\tresultObject.helperFunctions.push(merge);\n\t\t}\n\t} else {\n\t\tresultObject.functions = '{}';\n\t}\n\tresultObject.styles = resultObject.styles.length > 0 ? 'styles: ' + JSON.stringify(resultObject.styles) + ',' : '';\n\tresultObject.helperFunctions = resultObject.helperFunctions.join('\\n');\n\n\t// fill in place-holders in base code and return the result\n\treturn baseCode.replace(/\\{\\{([^\\}]+)\\}\\}/g, (g, m) => resultObject[m]);\n}\n","import {isFn, isObj, toArray} from './utils';\n\nfunction attachEvent (el, events, host) {\n\tif (!isFn(el.addEventListener)) return;\n\tlet findEl = (selector, target) => {\n\t\tlet node = toArray(el.querySelectorAll(selector));\n\t\twhile (node.length > 0 && target !== host) {\n\t\t\tif (node.indexOf(target) >= 0) return node[node.indexOf(target)];\n\t\t\ttarget = target.parentNode;\n\t\t}\n\t\treturn false;\n\t};\n\tevents.forEach(eventObj => {\n\t\tObject.keys(eventObj.handlers).forEach(event => {\n\t\t\tel.addEventListener(event, e => {\n\t\t\t\tlet target;\n\t\t\t\tif (eventObj.selector === ':host' || (target = findEl(eventObj.selector, e.target))) {\n\t\t\t\t\ttarget && (target.getHost = () => host.getHost());\n\t\t\t\t\teventObj.handlers[event].call(target || host, e);\n\t\t\t\t}\n\t\t\t}, false);\n\t\t});\n\t});\n}\n\nexport function attachSubEvents(events) {\n\tlet {subEvents, tag} = events;\n\tlet count = {};\n\t// make sure that we only attach events if we are actually in browser context\n\tif (tag.addEventListener.toString().indexOf('[native code]') >= 0) {\n\t\tsubEvents.events.forEach(event => {\n\t\t\tlet el = event.tag;\n\t\t\tif (!isObj(el)) {\n\t\t\t\t// we have a selector rather than an element\n\t\t\t\tcount[el] = (count[el] || 0) + 1;\n\t\t\t\t// turn the selector into the corresponding element\n\t\t\t\tel = tag.querySelectorAll(el)[count[el] - 1];\n\t\t\t}\n\t\t\t// if no events have been attached yet\n\t\t\tif (el && el.children.length > 0 && !el.children[0].__eventsAttached) {\n\t\t\t\t// attach children tag events to the shadow root\n\t\t\t\tattachEvent(el.children[0], event.childEvents, el);\n\t\t\t\t// attach host events directly to the component!\n\t\t\t\tattachEvent(el, event.hostEvents, el);\n\t\t\t\tel.children[0].__eventsAttached = true;\n\t\t\t}\n\t\t});\n\t}\n}","import {uuid, toArray} from './utils';\nimport {trigger} from './events';\n\nlet tagFilter = [];\nlet tagsCreated = [];\nlet dataResolver = (attr, value) => {\n\treturn attr;\n};\n\nfunction isArray(obj) {\n\treturn Object.prototype.toString.call(obj) === '[object Array]';\n}\n\nexport function hashCode(str) {\n\tlet hash = 0, i, chr;\n\tfor (i = 0; i < str.length; i++) {\n\t\tchr   = str.charCodeAt(i);\n\t\thash  = ((hash << 5) - hash) + chr;\n\t\thash |= 0;\n\t}\n\treturn hash;\n}\n\nexport function setDataResolver(resolver) {\n\tdataResolver = resolver;\n}\n\nexport function Tag(tagName, attributes, ...children) {\n\ttagName = tagName.toLowerCase();\n\tattributes = attributes || {};\n\tlet attributeHash = '';\n\tObject.keys(attributes).forEach(attr => {\n\t\tattributes[attr] = {name: attr, value: typeof attributes[attr] !== 'object' ? attributes[attr] : ('--' + dataResolver(attr, attributes[attr]) + '--')};\n\t\tattributeHash += attr + attributes[attr].value;\n\t});\n\tchildren = children.length === 1 && Array.isArray(children[0]) ? children[0] : children;\n\tlet tag = {\n\t\ttagName,\n\t\tattributes,\n\t\tchildren: children.filter(child => child),\n\t\t__hash: hashCode(tagName + '!' + attributeHash + '@' + children.map(child => (child && child.__hash || child)).join('!'))\n\t};\n\tif (tagFilter.indexOf(tagName) >= 0) tagsCreated.push(tag);\n\treturn tag;\n}\n\n/**\n * defines which VDOM nodes should be captured for getTagsCreated()\n * @param {Array} filter - an array of strings representing the tag names of the tags to be captured\n */\nexport function setFilter(filter) {\n\ttagFilter = filter;\n}\n\n/**\n * retrieves the list of tags that have been created since the last call of getTagsCreated()\n * @return {Array} - an array of VDOM nodes that were created\n */\nexport function clearTagsCreated() {\n\ttagsCreated = [];\n}\n\n/**\n * retrieves the list of tags that have been created since the last call of getTagsCreated()\n * @return {Array} - an array of VDOM nodes that were created\n */\nexport function getTagsCreated() {\n\tlet created = tagsCreated;\n\treturn created;\n}\n\n/**\n * Calculates the HTML structure as a String represented by the VDOM\n *\n * @param  {Object} node - the VDOM node whose inner HTML to generate\n * @return {String} - the HTML structure representing the VDOM\n */\nexport function getInnerHTML(node) {\n\tif (!node.children) return '';\n\tif (!isArray(node.children) && (typeof HTMLCollection !== 'undefined' && !(node.children instanceof HTMLCollection))) node.children = [node.children];\n\n\treturn (isArray(node) && node || (typeof HTMLCollection !== 'undefined' && node.children instanceof HTMLCollection ? [].slice.call(node.children) : node.children)).map(child => {\n\t\tif (typeof child !== 'object') {\n\t\t\treturn '' + child;\n\t\t} else if (isArray(child)) {\n\t\t\treturn getInnerHTML(child);\n\t\t} else {\n\t\t\tlet attributes = [''].concat(Object.keys(child.attributes).map(attr => attr+'=\"' + child.attributes[attr].value + '\"'));\n\t\t\tif (['img', 'link', 'meta', 'input', 'br', 'area', 'base', 'param', 'source', 'hr', 'embed'].indexOf(child.tagName) < 0) {\n\t\t\t\treturn `<${child.tagName}${attributes.join(' ')}>${getInnerHTML(child)}</${child.tagName}>`;\n\t\t\t} else {\n\t\t\t\treturn `<${child.tagName}${attributes.join(' ')}/>`;\n\t\t\t}\n\t\t}\n\t}).join('');\n}\n\n/**\n * Creates a new DOM node\n *\n * @param  {Object|String} node - a VDOM node\n * @param  {Document} document - the document in which to create the DOM node\n * @return {Node} - the DOM node created (either a text element or an HTML element)\n */\nfunction createElement(node, document) {\n\tlet tag;\n\tif (typeof node !== 'object') {\n\t\t// we have a text node, so create one\n\t\ttag = document.createTextNode('' + node);\n\t} else {\n\t\ttag = document.createElement(node.tagName);\n\t\t// add all required attributes\n\t\tObject.keys(node.attributes).forEach((attr) => {\n\t\t\ttag.setAttribute(attr, node.attributes[attr].value);\n\t\t});\n\t\t// define it's inner structure\n\t\ttag.innerHTML = getInnerHTML(node);\n\t\ttag.__hash = node.__hash;\n\t}\n\n\treturn tag;\n}\n\nfunction applyText(domChild, dom, node, document) {\n\t// simply apply the value\n\tif ((node || '').match(/<[\\w:_-]+[^>]*>/)) {\n\t\tif (dom.childNodes.length === 1) {\n\t\t\tdom.innerHTML = node;\n\t\t} else {\n\t\t\tlet html = document.createElement('span');\n\t\t\thtml.innerHTML = node;\n\t\t\tdom.replaceChild(html, domChild);\n\t\t}\n\t} else {\n\t\t// it's just a text node, so simply replace the element with the text node\n\t\tdom.replaceChild(createElement((node || '').replace(/&quot;/g, '\"').replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&'), document), domChild);\n\t}\n}\n\n/**\n * Applies a VDOM to an actual DOM, meaning that the state of the VDOM will be recreated on the DOM.\n * The end result is, that the DOM structure is the same as the VDOM structure. Existing elements will\n * be repurposed, new elements created where necessary.\n *\n * @param  {DOM} dom - the DOM to which the VDOM should be applied\n * @param  {Object} vdom - the VDOM to apply to the DOM\n * @param  {Document} document - the document that the DOM is based on, used for createElement() and createTextNode() calls\n */\nexport function applyDOM(dom, vdom, document) {\n\tif (!dom || !vdom) return;\n\tif (!isArray(vdom)) {\n\t\t// if we have a node\n\t\tif (!isArray(vdom.children)) vdom.children = [vdom.children];\n\t\tif (dom.__hash !== vdom.__hash) {\n\t\t\t// if the tag name is not the same\n\t\t\tif (vdom.tagName !== dom.tagName.toLowerCase()) {\n\t\t\t\t// replace the node entirely\n\t\t\t\tdom.parentNode.replaceChild(createElement(vdom, document), dom);\n\t\t\t} else {\n\t\t\t\tlet attributes = Object.keys(vdom.attributes);\n\t\t\t\t// check all vdom attributes\n\t\t\t\tfor (let attr, index = 0, len = attributes.length; attr = vdom.attributes[attributes[index]], index < len; index += 1) {\n\t\t\t\t\t// if the VDOM attribute is a non-object\n\t\t\t\t\tif (typeof attr.value !== 'object') {\n\t\t\t\t\t\t// check if it differs\n\t\t\t\t\t\tif (dom.getAttribute(attr.name) != attr.value) {\n\t\t\t\t\t\t\t// if so, apply it\n\t\t\t\t\t\t\tdom.setAttribute(attr.name, attr.value);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// the attribute is an object\n\t\t\t\t\t\tif (dom.getAttribute(attr.name) && dom.getAttribute(attr.name).match(/^--|--$/g)) {\n\t\t\t\t\t\t\t// if it has a complex value, use the data resolver to define it on the DOM\n\t\t\t\t\t\t\tlet id = dataResolver(attr.name, attr.value, dom.getAttribute(attr.name).replace(/^--|--$/g, ''));\n\t\t\t\t\t\t\t// only set the ID with markers so that we know it is supposed to be a complex value\n\t\t\t\t\t\t\tdom.setAttribute(attr.name, `--${id}--`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// if we have too many attributes in our DOM\n\t\t\t\tlet index = 0;\n\t\t\t\twhile (dom.attributes.length > attributes.length) {\n\t\t\t\t\tlet attr = dom.attributes[index];\n\t\t\t\t\t// if the respective attribute does not exist on the VDOM\n\t\t\t\t\tif (typeof attributes[attr.name] === 'undefined') {\n\t\t\t\t\t\t// remove it\n\t\t\t\t\t\tdom.removeAttribute(attr.name);\n\t\t\t\t\t\tindex = 0;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tindex += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// deal with the vdom's children\n\tlet children = (isArray(vdom) ? vdom : vdom.__hash !== dom.__hash ? vdom.children : []);\n\tfor (let index = 0, node, len = children.length; node = children[index], index < len; index += 1) {\n\t\tif (isArray(node)) return applyDOM(dom, node, document);\n\t\tlet domChild = dom.childNodes[index];\n\t\tif (typeof domChild === 'undefined') {\n\t\t\t// does not exist, so it needs to be appended\n\t\t\tdom.appendChild(createElement(node, document));\n\t\t} else if (domChild.nodeType === 3) {\n\t\t\t// is a text node\n\t\t\t// if the VDOM node is also a text node\n\t\t\tif (typeof node === 'string' && domChild.nodeValue !== node) {\n\t\t\t\tapplyText(domChild, dom, node, document);\n\t\t\t} else if (typeof node !== 'string') {\n\t\t\t\t// else replace with a new element\n\t\t\t\tdom.replaceChild(createElement(node, document), domChild);\n\t\t\t}\n\t\t} else if (domChild.nodeType === 1) {\n\t\t\t// is a normal HTML tag\n\t\t\tif (typeof node === 'object') {\n\t\t\t\t// the VDOM is also a tag, apply it recursively\n\t\t\t\tapplyDOM(domChild, node, document);\n\t\t\t} else {\n\t\t\t\tapplyText(domChild, dom, node, document);\n\t\t\t}\n\t\t}\n\t}\n\tif (dom.__hash !== vdom.__hash && dom.childNodes.length > children.length) {\n\t\t// remove superfluous child nodes\n\t\tfor (let index = children.length, len = dom.childNodes.length; index < len; index += 1) {\n\t\t\tdom.removeChild(dom.childNodes[index]);\n\t\t\tlen -= 1;\n\t\t\tindex -= 1;\n\t\t}\n\t}\n\tdom.__hash = vdom.__hash;\n}\n","import * as vdom from './vdom';\nimport {emptyFunc, isFn, isObj, uuid, merge, toArray} from './utils';\nimport {trigger, on} from './events';\n\nlet resolveData = (key, value, oldID) => {\n\tlet id = uuid();\n\tif (oldID) {\n\t\t// unregister old entry\n\t\tdelete dataRegistry[oldID];\n\t}\n\tdataRegistry[id] = value;\n\treturn id;\n};\n\nlet resolveDataKey = (key) => dataRegistry[key];\n\nlet tagRegistry = {},\n\tdataRegistry = {},\n\tdefaultFunctions = {\n\t\t'props': {},\n\t\t'mount': emptyFunc,\n\t\t'unmount': emptyFunc,\n\t\t'render': emptyFunc,\n\n\t\tgetHost() { return this; },\n\t\tsetProps: function setProps(name, value) {\n\t\t\tlet tag = this.getHost();\n\t\t\tif (isObj(name)) {\n\t\t\t\ttag.mounting = true;\n\t\t\t\tfor (let all in name) {\n\t\t\t\t\tsetProps.call(this, all, name[all]);\n\t\t\t\t}\n\t\t\t\ttag.mounting = false;\n\t\t\t} else {\n\t\t\t\ttag.props[name] = value;\n\t\t\t\tlet attrName = 'data-' + name.replace(/[A-Z]/g, g => `-${g.toLowerCase()}`);\n\t\t\t\tif (tag.attributes[attrName]) {\n\t\t\t\t\tdefineAttribute(tag, attrName, `--${resolveData(name, value, tag.attributes[attrName].value)}--`);\n\t\t\t\t}\n\t\t\t}\n\t\t\t!tag.mounting && trigger('--zino-rerender-tag', tag);\n\t\t}\n\t};\n\nexport function getDataRegistry() { return dataRegistry; }\nexport function setDataRegistry(newValues) { dataRegistry = newValues; }\nexport function setResolveData(fn, fn2) { resolveData = fn; resolveDataKey = fn2; }\nexport function registerTag(fn, document, Zino) {\n\tlet firstElement = new fn(vdom.Tag, Zino),\n\t\ttagName = (firstElement && firstElement.tagName) || (fn.name||'');\n\tif (!tagName) {\n\t\ttagName = fn.toString().split('\\n')[0].replace(/^\\s*function\\s+(.*?)\\s*\\(.*$/, '$1');\n\t\tif (!tagName.match(/^[A-Z][A-Za-z]*$/)) {\n\t\t\tthrow new Error('Unable to extract component\\'s tag name from provided component function: ' + fn.toString());\n\t\t}\n\t}\n\ttagName = tagName.replace(/([A-Z])/g, (g, beginning) => '-' + beginning).toLowerCase().replace(/^-/, '')\n\n\tif (firstElement instanceof fn) {\n\t\tfirstElement.__zino = Zino;\n\t\tfirstElement.functions = {\n\t\t\tprops: firstElement.props || {},\n\t\t\tevents: firstElement.events || {},\n\t\t\trender: firstElement.onrender || emptyFunc,\n\t\t\tmount: firstElement.onmount || emptyFunc,\n\t\t\tunmount: firstElement.onunmount || emptyFunc\n\t\t};\n\t}\n\n\tif (tagRegistry[tagName]) {\n\t\t// tag is already registered\n\t\t// initialize all occurences in provided context\n\t\tdocument && toArray(document.getElementsByTagName(tagName)).forEach(tag => initializeTag(tag, tagRegistry[tagName]));\n\t\treturn;\n\t}\n\n\ttrigger('publish-style', {styles: firstElement.styles, tagName});\n\tfirstElement.functions = merge({}, defaultFunctions, firstElement.functions);\n\ttagRegistry[tagName] = firstElement;\n\n\t// initialize all occurences in provided context\n\tdocument && toArray(document.getElementsByTagName(tagName)).forEach(tag => initializeTag(tag, tagRegistry[tagName]));\n}\n\nexport function mount(tag, ignoreRender) {\n\tif (!tag || !tag.tagName) return {};\n\tlet entry = tagRegistry[tag.tagName.toLowerCase()];\n\tif (!entry || tag.getAttribute('__ready')) return {};\n\tif (ignoreRender) entry.functions.render = emptyFunc;\n\treturn initializeTag.call(ignoreRender ? {noEvents: true} : this, tag, entry);\n}\n\nexport function render(tag) {\n\tif (!tag || !tag.addEventListener) return;\n\tlet subEvents = renderTag(tag);\n\tif (!subEvents) return;\n\ttrigger('--zino-attach-events', {\n\t\tsubEvents,\n\t\ttag\n\t});\n}\n\nexport function flushRegisteredTags() {\n\ttagRegistry = {};\n}\n\nfunction initializeTag(tag, registryEntry) {\n\t// check if the tag has been initialized already\n\tif (tag.__vdom || !registryEntry) return;\n\tlet functions = registryEntry.functions;\n\n\t// if it has been pre-rendered\n\tif (tag.children.length > 0 && tag.children[0].attributes && tag.children[0].attributes['class'] && tag.children[0].attributes['class'].value === '-shadow-root') {\n\t\tlet sibling = tag.children[1];\n\t\t// remove original HTML content\n\t\tif (sibling && sibling.className === '-original-root') {\n\t\t\ttag.__i = sibling.innerHTML;\n\t\t\tsetElementAttr(sibling, tag);\n\t\t\tsibling.parentNode.removeChild(sibling);\n\t\t}\n\t\ttag.isRendered = true;\n\t} else {\n\t\ttag.__i = tag.ownerDocument ? tag.innerHTML : vdom.getInnerHTML(tag);\n\t\tsetElementAttr(tag);\n\t\ttag.innerHTML = '<div class=\"-shadow-root\"></div>';\n\t\ttag.isRendered = false;\n\t}\n\tif (!tag.nodeType) while (tag.children.length > 1) {\n\t\ttag.children.pop();\n\t}\n\ttrigger('--zino-initialize-node', {tag, node: functions, entry: registryEntry});\n\ttag.__vdom = {};\n\ttag.createNode = vdom.Tag;\n\n\t// render the tag's content\n\tlet subEvents = !tag.isRendered && renderTag.call(this, tag) || {events:[]};\n\n\t// attach events\n\tlet hostEvents = [],\n\t\tevents = functions.events || [],\n\t\tchildEvents = Object.keys(events).filter(all => {\n\t\t\tlet isNotSelf = all !== ':host' && all !== tag.tagName;\n\t\t\tif (!isNotSelf) hostEvents.push({handlers: events[all], selector: all});\n\t\t\treturn isNotSelf;\n\t\t}).map(e => ({selector: e, handlers: events[e]}));\n\n\tsubEvents.events = subEvents.events.concat({childEvents, hostEvents, tag: this && this.noEvents ? tag.tagName : tag})\n\n\tif (!tag.attributes.__ready) {\n\t\tdefineAttribute(tag, '__ready', true);\n\t}\n\n\tif (!this || this.noEvents !== true) {\n\t\t// attach sub events\n\t\ttrigger('--zino-attach-events', {subEvents, tag});\n\n\t\t[tag].concat(tag.__subs).forEach(function(el) {\n\t\t\tlet actual = el && el.getHost() || {};\n\t\t\tisFn(actual.onready) && actual.onready.call(actual);\n\t\t});\n\t} else {\n\t\treturn subEvents;\n\t}\n}\n\nfunction defineAttribute(tag, name, value) {\n\tif (tag.ownerDocument) {\n\t\t// use the HTMLElement's setAttribute to define the attribute\n\t\t(tag.prototype || HTMLElement.prototype).setAttribute.call(tag, name, value);\n\t} else {\n\t\t// we now know it can only be a vdom node, so set attribute vdom-style\n\t\ttag.attributes[name] = {name, value};\n\t}\n}\n\nfunction initializeNode({tag, node: functions = defaultFunctions, entry}) {\n\t// copy all defined functions/attributes\n\tfor (let all in functions) {\n\t\tlet entry = functions[all];\n\t\tif (['mount', 'unmount', 'events', 'render'].indexOf(all) < 0) {\n\t\t\tif (isFn(entry)) {\n\t\t\t\ttag[all] = entry.bind(tag);\n\t\t\t} else {\n\t\t\t\ttag[all] = isObj(tag[all]) ? merge({}, entry, tag[all]) : entry;\n\t\t\t}\n\t\t}\n\t}\n\t// define basic properties\n\tlet desc = Object.getOwnPropertyDescriptor(tag, 'body');\n\tif (!desc || typeof desc.get === 'undefined') {\n\t\tObject.defineProperty(tag, 'body', {\n\t\t\tset(val) {\n\t\t\t\ttag.__i = val;\n\t\t\t\tsetElementAttr(tag);\n\t\t\t\ttrigger('--zino-rerender-tag', tag.getHost());\n\t\t\t},\n\t\t\tget() { return tag.__i; }\n\t\t});\n\t}\n\ttag.setAttribute = function(attr, val) {\n\t\tdefineAttribute(this, attr, val);\n\t\ttrigger('--zino-rerender-tag', this);\n\t};\n\n\t// call mount callback\n\ttag.props = merge({}, functions.props, getAttributes(tag, true));\n\ttag.attrs = getAttributes(tag);\n\n\ttry {\n\t\ttag.mounting = true;\n\t\tfunctions.mount.call(tag, entry.__zino);\n\t\tdelete tag.mounting;\n\t} catch (e) {\n\t\te.message = 'Unable to call mount function for ' + tag.tagName + ': ' + (e.message || e);\n\t\tthrow e;\n\t}\n}\n\nfunction renderTag(tag, registryEntry = tagRegistry[tag.tagName.toLowerCase()]) {\n\tlet events = [],\n\t\trenderCallbacks = [],\n\t\trenderedSubElements = [],\n\t\trenderedDOM;\n\n\t// do the actual rendering of the component\n\tvdom.setDataResolver(resolveData);\n\tvdom.clearTagsCreated();\n\tlet data = getAttributes(tag);\n\tlet dataList = [];\n\n\tfunction dataToString(data, depth = 0) {\n\t\tlet num = 0;\n\t\tfor (let all in data) {\n\t\t\tif (typeof data[all] !== 'object') {\n\t\t\t\tnum = vdom.hashCode(num + ';' + all + ':' + (data[all] === null || data[all] === undefined ? 'null' : data[all]).toString());\n\t\t\t} else {\n\t\t\t\tlet res = all + ':';\n\t\t\t\tif (depth < 10 && !(depth === 0 && all === 'element') && dataList.indexOf(data[all]) < 0) {\n\t\t\t\t\tdataList.push(data[all]);\n\t\t\t\t\tres += dataToString(data[all], depth + 1);\n\t\t\t\t}\n\t\t\t\tnum = vdom.hashCode(num + ';' + res);\n\t\t\t}\n\t\t}\n\t\treturn num;\n\t}\n\tdataList = [];\n\tlet hash = dataToString(data);\n\n\tif (tag.__dataHash === hash) {\n\t\t// data did not change, so no re-render required\n\t\treturn {events, renderCallbacks, data, subElements: renderedSubElements};\n\t}\n\ttag.__dataHash = hash;\n\n\tif (isFn(registryEntry.render)) {\n\t\t// tell the vdom which tags to remember to look for\n\t\tvdom.setFilter(Object.keys(tagRegistry));\n\t\trenderedDOM = vdom.Tag('div', {'class': '-shadow-root'}, registryEntry.render.call(tag, data));\n\t} else {\n\t\tthrow new Error('No render function provided in component ' + tag.tagName);\n\t}\n\n\t// unmount previously rendered sub components\n\ttag.__subs && tag.__subs.forEach(unmount);\n\n\t// render all contained sub components\n\t// retrieve the tags that the vdom was made aware of (all our registered components)\n\trenderedSubElements = vdom.getTagsCreated();\n\tfor (let idx = 0, len = renderedSubElements.length; idx < len; idx += 1) {\n\t\tlet subEl = renderedSubElements[idx];\n\n\t\t// initialize them all\n\t\tlet subElEvents = initializeTag.call({\n\t\t\tnoRenderCallback: true,\n\t\t\tnoEvents: true\n\t\t}, subEl, tagRegistry[subEl.tagName]);\n\t\tif (subElEvents) {\n\t\t\t// make sure that we build the hierarchical order of sub elements (same as what comes back from querySelectorAll)\n\t\t\trenderedSubElements.splice.apply(renderedSubElements, [idx + 1, 0].concat(subElEvents.subElements));\n\t\t\t// array has been extended, adapt...\n\t\t\tidx += subElEvents.subElements.length;\n\t\t\tlen += subElEvents.subElements.length;\n\t\t\tevents = events.concat(subElEvents.events);\n\t\t\trenderCallbacks = renderCallbacks.concat(subElEvents.renderCallbacks);\n\t\t}\n\t}\n\n\tif (tag.ownerDocument) {\n\t\t// has been rendered before, so just apply diff\n\t\tvdom.applyDOM(tag.children[0], renderedDOM, tag.ownerDocument);\n\t} else {\n\t\ttag.children[0] = renderedDOM;\n\t\ttag.children[0].__hash = renderedDOM.__hash;\n\t}\n\ttag.__subs = renderedSubElements;\n\ttag.__vdom = renderedDOM;\n\n\tlet inconsistent = false;\n\n\tdo {\n\t\tif (inconsistent) {\n\t\t\ttag.children[0].innerHTML = vdom.getInnerHTML(renderedDOM);\n\t\t\tinconsistent = false;\n\t\t\tbreak;\n\t\t}\n\t\t// if we have rendered any sub components, retrieve their actual DOM node\n\t\tif (renderedSubElements.length > 0 && tag.querySelectorAll) {\n\t\t\tfor (let subEl, ready = tag.querySelectorAll('[__ready]'), index = 0, len = ready.length; subEl = ready[index], index < len; index += 1) {\n\t\t\t\t// apply all additional functionality to them (custom functions, attributes, etc...)\n\t\t\t\tmerge(subEl, renderedSubElements[index]);\n\t\t\t\t// update getHost to return the DOM node instead of the vdom node\n\t\t\t\tif (!renderedSubElements[index] || subEl.tagName.toLowerCase() !== renderedSubElements[index].tagName) {\n\t\t\t\t\tconsole.info('Inconsistent state - might be caused by additional components generated in render callback: ', subEl, tag.__subs, ready);\n\t\t\t\t\tinconsistent = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tsubEl.getHost = renderedSubElements[index].getHost = defaultFunctions.getHost.bind(subEl);\n\t\t\t}\n\t\t}\n\t} while (inconsistent);\n\ttag.isRendered = true;\n\n\t// if this is not a sub component's rendering run\n\tif (!this || !this.noRenderCallback) {\n\t\t// call all of our sub component's render functions\n\t\trenderCallbacks.forEach(callback => {\n\t\t\ttry {\n\t\t\t\tcallback.fn.call(callback.tag.getHost(), tagRegistry[callback.tag.getHost().tagName.toLowerCase()].__zino);\n\t\t\t} catch (e) {\n\t\t\t\tthrow new Error('Unable to call render callback for component ' + callback.tag.tagName + ': ' + (e.message || e));\n\t\t\t}\n\t\t});\n\t\t// call our own rendering function\n\t\ttry {\n\t\t\tregistryEntry.functions.render.call(tag, registryEntry.__zino);\n\t\t} catch (e) {\n\t\t\tthrow new Error('Unable to call render callback for component ' + tag.tagName + ': ' + (e.message || e));\n\t\t}\n\t} else {\n\t\t// just add this sub component's rendering function to the list\n\t\trenderCallbacks.push({fn: registryEntry.functions.render, tag});\n\t}\n\n\treturn {events, renderCallbacks, data, subElements: renderedSubElements};\n}\n\nexport function unmount(tag) {\n\tlet name = (tag && tag.tagName || '').toLowerCase(),\n\t\tentry = tagRegistry[name];\n\tif (tag && name && entry) {\n\t\t[].forEach.call(tag.nodeType === 1 && tag.attributes || Object.keys(tag.attributes).map(attr => tag.attributes[attr]), attr => {\n\t\t\t// cleanup saved data\n\t\t\tif (attr.name.indexOf('data-') >= 0) {\n\t\t\t\tdelete dataRegistry[attr.value];\n\t\t\t}\n\t\t});\n\t\ttry {\n\t\t\tentry.__subs && entry.__subs.forEach(unmount);\n\t\t\tentry.functions.unmount.call(tag, entry.__zino);\n\t\t} catch (e) {\n\t\t\tthrow new Error('Unable to unmount tag ' + name + ': ' + (e.message || e));\n\t\t}\n\t}\n}\n\nfunction getAttributes(tag, propsOnly) {\n\tlet attrs = {props: tag.props, element: tag.element, styles: tag.styles, body: tag.__i},\n\t\tprops = attrs.props;\n\n\t[].forEach.call(tag.nodeType === 1 && tag.attributes || Object.keys(tag.attributes).map(attr => tag.attributes[attr]), attribute => {\n\t\tlet isComplex = attribute.name.indexOf('data-') >= 0 && typeof attribute.value === 'string' && attribute.value.substr(0, 2) === '--';\n\t\tlet value = attribute.value;\n\t\tattrs[attribute.name] || (attrs[attribute.name] = isComplex && typeof value === 'string' && resolveDataKey(value.replace(/^--|--$/g, '')) || value);\n\t\tif (attribute.name.indexOf('data-') === 0) {\n\t\t\tif (typeof attrs[attribute.name] === 'string' && attrs[attribute.name].match(/^--[a-f0-9-]+--$/)) {\n\t\t\t\tattrs[attribute.name] = resolveDataKey(value.replace(/^--|--$/g, ''));\n\t\t\t}\n\t\t\tprops[attribute.name.replace(/^data-/g, '').replace(/(\\w)-(\\w)/g, (g, m1, m2) => m1 + m2.toUpperCase())] = attrs[attribute.name];\n\t\t}\n\t});\n\n\tif (propsOnly) return props;\n\treturn attrs;\n}\n\nfunction setElementAttr(source, target = source) {\n\tlet baseAttrs = {};\n\t[].forEach.call(source.children, el => {\n\t\tif (!el.tagName) return;\n\t\tlet name = el.tagName.toLowerCase();\n\t\tif (baseAttrs[name]) {\n\t\t\tif (!baseAttrs[name].isArray) {\n\t\t\t\tbaseAttrs[name] = [baseAttrs[name]];\n\t\t\t\tbaseAttrs[name].isArray = true;\n\t\t\t}\n\t\t\tbaseAttrs[name].push(el);\n\t\t} else {\n\t\t\tbaseAttrs[name] = el;\n\t\t}\n\t});\n\ttarget.element = baseAttrs;\n}\n\non('--zino-initialize-node', initializeNode);\n","import {registerTag, render, mount, unmount, flushRegisteredTags} from './core';\nimport {emptyFunc, identity, isObj, toArray, isFn} from './utils';\nimport {on, one, off, trigger} from './events';\n\nlet document,\n\tloadComponent = emptyFunc;\n\nexport let Zino = {\n\ton, one, off, trigger,\n\tfetch: emptyFunc,\n\n\timport: function(path, callback = emptyFunc) {\n\t\tlet runCode = code => {\n\t\t\tif (code) {\n\t\t\t\tisFn(code.setDocument) && code.setDocument(document);\n\t\t\t\tregisterTag(code, document.body, Zino);\n\t\t\t}\n\t\t\tcallback();\n\t\t};\n\t\tif (typeof path === 'function') {\n\t\t\trunCode(path);\n\t\t} else {\n\t\t\tloadComponent((this.path || '') + path, runCode);\n\t\t}\n\t}\n};\n\nexport let actions = {mount, render, unmount};\nexport function setDocument(doc) { document = doc; }\nexport function setComponentLoader(fn) { loadComponent = fn; }\nexport {flushRegisteredTags};\n\non('publish-style', data => {\n\tif (typeof data.tagName === 'string' && data.styles && data.styles.length > 0) {\n\t\tif (document.getElementById('style:' + data.tagName)) return;\n\t\tlet style = document.createElement('style');\n\t\tstyle.innerHTML = data.styles;\n\t\tstyle.setAttribute('id', 'style:' + data.tagName);\n\t\tdocument.head.appendChild(style);\n\t}\n});\n","import {isObj, toArray, identity} from './utils';\nimport * as browser from './browser';\nimport {Zino, actions, setDocument, setComponentLoader} from './facade';\nimport {setDataRegistry} from './core';\n\nlet urlRegistry = window.zinoTagRegistry || {},\n\tdirtyTags = [],\n\tmountTags = [],\n\tparseCode = identity,\n\ttagObserver = new MutationObserver(records => {\n\t\trecords.forEach(record => {\n\t\t\tlet added = record.addedNodes,\n\t\t\t\tremoved = record.removedNodes;\n\n\t\t\tif (added.length > 0) {\n\t\t\t\tmountTags = [].concat.call(added, mountTags);\n\t\t\t} else if (removed.length > 0) {\n\t\t\t\t[].forEach.call(removed, tag => {\n\t\t\t\t\t(tag.children && toArray(tag.querySelectorAll('[__ready]')) || []).concat(tag).forEach(actions.unmount);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n\nsetDataRegistry(window.zinoDataRegistry || {});\n\nwindow.Zino = Zino;\nZino.isBrowser = true;\nZino.isServer = false;\nZino.fetch = function(url, callback, cache, code) {\n\tif (cache && urlRegistry[url] && !urlRegistry[url].callback) {\n\t\treturn callback(urlRegistry[url], 200);\n\t} else if (isObj(urlRegistry[url])) {\n\t\treturn urlRegistry[url].callback.push(callback);\n\t}\n\turlRegistry[url] = code || {\n\t\tcallback: [callback]\n\t};\n\tif (code) return;\n\tlet req = new XMLHttpRequest();\n\treq.open('GET', url, true);\n\treq.onreadystatechange = () => {\n\t\tif (req.readyState === 4) {\n\t\t\tlet callbacks = urlRegistry[url].callback;\n\t\t\tif (req.status === 200) {\n\t\t\t\turlRegistry[url] = req.responseText;\n\t\t\t}\n\t\t\tif (!cache) delete urlRegistry[url];\n\t\t\tcallbacks.forEach(cb => cb(req.responseText, req.status));\n\t\t}\n\t};\n\treq.send();\n};\nsetComponentLoader((url, fn) => {\n\tZino.fetch(url, (data, status) => {\n\t\tlet path = url.replace(/[^\\/]+$/g, '');\n\t\tif (status === 200) {\n\t\t\tlet code;\n\t\t\ttry {\n\t\t\t\tdata = parseCode(data);\n\t\t\t\tcode = new Function('return ' + data.replace(/url\\((\\\\*['\"])?(.*?)\\1\\)/g, function(g, quote, url) {\n\t\t\t\t\t\tif (url.indexOf('data:') === 0 || url.indexOf('http') === 0 || url.indexOf('//') === 0 || url.indexOf('/') === 0) return g;\n\t\t\t\t\t\treturn 'url(' + path + url + ')';\n\t\t\t\t\t}).replace(/\\bZino.import\\s*\\(/g, 'Zino.import.call({path: ' + JSON.stringify(path) + '}, ').trim().replace(/;$/, ''))();\n\t\t\t\tif (typeof code(() => {}, Zino) === 'function') {\n\t\t\t\t\tcode = code();\n\t\t\t\t}\n\t\t\t} catch(e) {\n\t\t\t\te.message = 'Unable to import tag ' + url.replace(/.*\\//g, '') + ': ' + e.message;\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t\tfn(code);\n\t\t}\n\t}, true);\n});\nsetDocument(window.document);\n\nexport {Zino};\nexport function setParser(fn) { parseCode = fn; };\n\nZino.on('--zino-attach-events', browser.attachSubEvents);\nZino.on('--zino-rerender-tag', tag => dirtyTags.indexOf(tag) < 0 && dirtyTags.push(tag));\nZino.trigger('publish-style', '[__ready] { contain: content; }');\ntoArray(document.querySelectorAll('[rel=\"zino-tag\"]')).forEach(tag => Zino.import(tag.href));\ntagObserver.observe(document.body, {\n\tsubtree: true,\n\tchildList: true\n});\n\nfunction loopList(start, list, action) {\n\twhile (list.length > 0) {\n\t\tlet entry = list.shift();\n\t\tif (entry instanceof NodeList || entry.length > 0) {\n\t\t\tfor (var all in entry) {\n\t\t\t\taction(entry[all]);\n\t\t\t}\n\t\t} else {\n\t\t\taction(entry);\n\t\t}\n\t\tif (performance.now() - start > 16) { break; }\n\t}\n}\n\nrequestAnimationFrame(function reRender(start) {\n\tloopList(start, mountTags, actions.mount);\n\tloopList(start, dirtyTags, actions.render);\n\trequestAnimationFrame(reRender);\n});\n","import {parse} from './mustacheparser';\nimport {Zino, setParser} from './zino-light';\n\nexport default Zino;\nsetParser(data => {\n\t// if we have HTML input\n\tif (data.trim().indexOf('<') === 0) {\n\t\t// convert it to JS\n\t\tdata = parse(data);\n\t}\n\n\treturn data;\n});\n"],"names":["merge","target","args","arg","len","length","index","all","HTMLElement","propDetails","value","writable","obj","attribute","isObj","Object","getOwnPropertyDescriptor","uuid","replace","r","Math","random","c","toString","toArray","startIdx","Array","prototype","slice","call","isFn","fn","emptyFunc","identity","a","eventQueue","publishEvent","type","data","name","indexOf","trigger","result","on","push","off","one","self","apply","arguments","tagRegExp","attrRegExp","commentRegExp","syntax","safeAccess","spread","renderStyle","baseCode","handleStyles","tagName","styles","map","code","style","global","match","trim","selectors","split","selector","RegExp","join","parse","resultObject","usesMerge","usesRenderStyle","usesSpread","lastIndex","level","tagStack","getData","handleText","text","isAttr","cat","substr","exec","frag","substring","key","Error","makeAttributes","attrs","attributes","attr","toLowerCase","content","g","m","functions","x","$1","$2","render","expected","pop","helperFunctions","JSON","stringify","attachEvent","el","events","host","addEventListener","findEl","node","querySelectorAll","parentNode","forEach","keys","eventObj","handlers","event","e","getHost","attachSubEvents","subEvents","tag","count","children","__eventsAttached","childEvents","hostEvents","tagFilter","tagsCreated","dataResolver","isArray","hashCode","str","hash","i","chr","charCodeAt","setDataResolver","resolver","Tag","attributeHash","babelHelpers.typeof","filter","child","__hash","setFilter","clearTagsCreated","getTagsCreated","created","getInnerHTML","HTMLCollection","concat","createElement","document","createTextNode","setAttribute","innerHTML","applyText","domChild","dom","childNodes","html","replaceChild","applyDOM","vdom","getAttribute","id","removeAttribute","appendChild","nodeType","nodeValue","removeChild","resolveData","oldID","dataRegistry","resolveDataKey","tagRegistry","defaultFunctions","setProps","mounting","props","attrName","setDataRegistry","newValues","registerTag","Zino","firstElement","beginning","__zino","onrender","onmount","onunmount","getElementsByTagName","initializeTag","mount","ignoreRender","entry","noEvents","renderTag","registryEntry","__vdom","sibling","className","__i","isRendered","ownerDocument","createNode","isNotSelf","__ready","__subs","actual","onready","defineAttribute","initializeNode","bind","desc","get","defineProperty","val","getAttributes","message","renderCallbacks","renderedSubElements","renderedDOM","dataList","dataToString","depth","num","undefined","res","__dataHash","subElements","unmount","idx","subEl","subElEvents","splice","inconsistent","ready","info","noRenderCallback","callback","propsOnly","element","body","isComplex","m1","m2","toUpperCase","setElementAttr","source","baseAttrs","loadComponent","path","runCode","setDocument","actions","doc","setComponentLoader","getElementById","head","urlRegistry","window","zinoTagRegistry","dirtyTags","mountTags","parseCode","tagObserver","MutationObserver","added","record","addedNodes","removed","removedNodes","zinoDataRegistry","isBrowser","isServer","fetch","url","cache","req","XMLHttpRequest","open","onreadystatechange","readyState","callbacks","status","responseText","cb","send","Function","quote","setParser","browser","import","href","observe","loopList","start","list","action","shift","NodeList","performance","now","requestAnimationFrame","reRender"],"mappings":"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"}